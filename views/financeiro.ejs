<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Controle Financeiro</title>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #151922; color: #cfd8dc; margin: 0; padding: 20px; display: flex; flex-direction: column; height: 100vh; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .btn-voltar { background: #333; color: #fff; text-decoration: none; padding: 8px 15px; border-radius: 4px; }
        
        /* CARDS DE TOTAL */
        .cards-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .card { flex: 1; background: #1e2532; padding: 20px; border-radius: 8px; border-left: 5px solid #555; }
        .card h3 { margin: 0; font-size: 0.9rem; color: #aaa; text-transform: uppercase; }
        .card .valor { font-size: 2rem; font-weight: bold; margin-top: 5px; color: #fff; }

        /* CORES DOS CARDS */
        .green { border-color: #10b981; } .green .valor { color: #10b981; }
        .red { border-color: #ef4444; } .red .valor { color: #ef4444; }
        .gold { border-color: #D4AF37; } .gold .valor { color: #D4AF37; }

        /* √ÅREA PRINCIPAL */
        .main { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; flex: 1; overflow: hidden; }
        .painel { background: #1e2532; border-radius: 8px; border: 1px solid #2d3748; display: flex; flex-direction: column; padding: 15px; }
        
        /* TABELA DE MOVIMENTOS */
        .table-scroll { overflow-y: auto; flex: 1; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 10px; background: #151922; color: #D4AF37; position: sticky; top: 0; }
        td { padding: 10px; border-bottom: 1px solid #333; font-size: 0.9rem; }
        
        /* BOT√ÉO FECHAR CAIXA */
        .btn-fechar {
            background: #D4AF37; color: #000; border: none; padding: 15px; font-size: 1.2rem;
            font-weight: bold; width: 100%; cursor: pointer; border-radius: 4px; margin-top: auto;
        }
        .btn-fechar:hover { background: #fff; }
    </style>
</head>
<body>

    <div class="header">
        <a href="/" class="btn-voltar">‚¨Ö Voltar ao Dashboard</a>
        <h2 style="color: #fff; margin:0;">FINANCEIRO DO DIA (<%= new Date().toLocaleDateString('pt-BR') %>)</h2>
    </div>

    <!-- CARDS DE RESUMO -->
    <div class="cards-row">
        <div class="card green">
            <h3>Total Entradas (Vendas)</h3>
            <div class="valor">R$ <%= parseFloat(entrada).toFixed(2) %></div>
        </div>
        <div class="card red">
            <h3>Total Sa√≠das (Despesas/Compras)</h3>
            <div class="valor">R$ <%= parseFloat(saida).toFixed(2) %></div>
        </div>
        <div class="card gold">
            <h3>Saldo em Caixa (Dinheiro L√≠quido)</h3>
            <div class="valor">R$ <%= parseFloat(saldo).toFixed(2) %></div>
        </div>
    </div>

    <div class="main">
        <!-- ESQUERDA: RELAT√ìRIO DETALHADO -->
        <div class="painel">
            <h3 style="color:#D4AF37; margin-top:0;">üìú Extrato de Movimenta√ß√µes</h3>
            <div class="table-scroll">
                <table>
                    <thead>
                        <tr>
                            <th>Hora</th>
                            <th>Tipo</th>
                            <th>Descri√ß√£o</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% movimentos.forEach(m => { %>
                            <tr>
                                <!-- Hora -->
                                <td><%= new Date(m.data_movimento).toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}) %></td>
                                
                                <!-- Tipo (Entrada/Sa√≠da) com IF/ELSE para evitar erros -->
                                <td>
                                    <% if (m.tipo == 'ENTRADA') { %>
                                        <span style="color: #10b981; font-weight: bold;">ENTRADA</span>
                                    <% } else { %>
                                        <span style="color: #ef4444; font-weight: bold;">SA√çDA</span>
                                    <% } %>
                                </td>

                                <!-- Descri√ß√£o -->
                                <td><%= m.descricao %></td>

                                <!-- Valor Formatado -->
                                <td>R$ <%= parseFloat(m.valor).toFixed(2) %></td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- DIREITA: FECHAMENTO -->
        <div class="painel">
            <h3 style="color:#D4AF37; margin-top:0;">üîí Fechamento de Caixa</h3>
            <p style="color:#888; font-size:0.9rem;">Confira os valores f√≠sicos na gaveta antes de fechar.</p>
            
            <form action="/fechar-caixa" method="POST" style="display:flex; flex-direction:column; height:100%;">
                <input type="hidden" name="entrada" value="<%= entrada %>">
                <input type="hidden" name="saida" value="<%= saida %>">
                <input type="hidden" name="saldo" value="<%= saldo %>">
                
                <label style="color:#aaa; margin-bottom:5px;">Observa√ß√µes do Fechamento:</label>
                <textarea name="obs" rows="5" style="background:#151922; border:1px solid #333; color:#fff; padding:10px;" placeholder="Ex: Faltou 0,50 centavos; Sangria realizada..."></textarea>

                <button type="submit" class="btn-fechar" onclick="return confirm('Tem certeza que deseja fechar o caixa do dia?')">
                    CONFIRMAR FECHAMENTO
                </button>
            </form>
        </div>
    </div>

</body>
</html>